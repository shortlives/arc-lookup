<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ARC Lookup</title>
<style>
  body {
    background:#000;
    color:#fff;
    font-family:Segoe UI, sans-serif;
    padding:20px;
  }

  /* Top button row */
  .top-buttons {
    display:flex;
    gap:10px;
    margin-bottom:15px;
    flex-wrap:wrap;
  }
  .top-buttons a, .mode-btn {
    background:#222;
    color:#fff;
    border:1px solid #444;
    border-radius:6px;
    padding:6px 12px;
    font-size:14px;
    text-decoration:none;
    cursor:pointer;
  }
  .top-buttons a:hover, .mode-btn:hover {
    background:#333;
  }

  /* Mode toggle buttons */
  .mode-btn.active {
    background:#555;
    border-color:#888;
  }

  input {
    font-size:22px;
    padding:12px;
    width:95%;
    margin:10px 0 15px 0;
  }

  .item-name {
    font-size:26px;
    font-weight:bold;
  }
  .line {
    margin:4px 0;
    font-size:18px;
  }
  .section-header {
    margin:10px 0 4px 0;
    font-size:20px;
    font-weight:bold;
    color:#ffa500;
  }
  hr {
    border:1px solid #333;
    margin:10px 0;
  }
</style>
</head>
<body>

<!-- External Links -->
<div class="top-buttons">
  <a href="https://mapgenie.io/arc-raiders" target="_blank">Maps</a>
  <a href="https://docs.google.com/spreadsheets/d/1FYBQG7Zq-hb-73baiUtMGrUUUjtif3mbBUZcpHN2X3U/edit?gid=732163012#gid=732163012"
     target="_blank">Spreadsheet</a>
</div>

<!-- Mode buttons -->
<div class="top-buttons">
  <button id="modeNormal" class="mode-btn active">Normal Search</button>
  <button id="modeReverse" class="mode-btn">Reverse Search</button>
</div>

<!-- Search boxes -->
<input id="searchNormal" placeholder="Type item name..." autofocus>
<input id="searchReverse" placeholder="Type a target item (show recyclers)..." style="display:none;">

<div id="result"></div>

<script>
const sheetURL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vQ8XIQtZGS9iURh9D5oWsgyyBMqNJkLy9x0olt6DKKlCHevSpZ3qQevYZjrpctOLjOUyDFv1HEjkqGq/pub?output=csv";

const data = [];

/* Always clear search box when clicked */
function enableAutoClear(input) {
  input.addEventListener("focus", function() {
    this.value = "";
  });
}
enableAutoClear(document.getElementById("searchNormal"));
enableAutoClear(document.getElementById("searchReverse"));

/* Load CSV */
fetch(sheetURL)
  .then(r => r.text())
  .then(text => {
    const rows = text.replace(/\r/g,"").split("\n");
    rows.shift();

    for (let r of rows) {
      if (!r.trim()) continue;
      const f = csvSplit(r);
      data.push({
        name:      f[0] || "",
        rarity:    f[1] || "",
        recycle1:  f[2] || "",
        recycle2:  f[3] || "",
        sellPrice: f[4] || "",
        category:  f[5] || "",
        keep1:     f[6] || "",
        keep2:     f[7] || "",
        keep3:     f[8] || "",
        notes:     f[9] || ""
      });
    }
});

function csvSplit(row) {
  let out = [], field = "", q = false;
  for (const ch of row) {
    if (ch === '"') { q = !q; continue; }
    if (ch === ',' && !q) { out.push(field); field = ""; continue; }
    field += ch;
  }
  out.push(field);
  return out;
}

function extractItemNameFromRecycle(str) {
  return str.replace(/^\s*\d+\s*x\s*/i, "").trim();
}

/* ======================
   MODE TOGGLE
====================== */
const normalBtn = document.getElementById("modeNormal");
const reverseBtn = document.getElementById("modeReverse");

const searchNormal = document.getElementById("searchNormal");
const searchReverse = document.getElementById("searchReverse");

normalBtn.onclick = () => {
  normalBtn.classList.add("active");
  reverseBtn.classList.remove("active");
  searchReverse.style.display = "none";
  searchNormal.style.display = "block";
  searchNormal.focus();
};

reverseBtn.onclick = () => {
  reverseBtn.classList.add("active");
  normalBtn.classList.remove("active");
  searchNormal.style.display = "none";
  searchReverse.style.display = "block";
  searchReverse.focus();
};

/* ======================
   NORMAL SEARCH
====================== */
let timer1 = null;
searchNormal.addEventListener("input", function () {
  clearTimeout(timer1);
  const q = this.value.trim();
  timer1 = setTimeout(() => runNormalSearch(q), 100);
});

function runNormalSearch(query) {
  const q = query.toLowerCase();
  const out = document.getElementById("result");
  out.innerHTML = "";
  if (!q) return;

  const matches = data.filter(d => d.name.toLowerCase().includes(q));
  if (!matches.length) {
    out.innerHTML = "<div>No match</div>";
    return;
  }

  let html = "";

  /* Draw main item results */
  matches.forEach(item => {
    const rarity = (item.rarity || "").toLowerCase();
    let nameColor = rarityColor(rarity);

    const priceNum = parseInt((item.sellPrice || "").replace(/[^0-9]/g,"")) || 0;
    let priceColor = priceColorPick(priceNum);

    const recycleParts = [];
    if (item.recycle1) recycleParts.push(item.recycle1);
    if (item.recycle2) recycleParts.push(item.recycle2);

    const questParts = [];
    if (item.keep1) questParts.push(item.keep1);
    if (item.keep2) questParts.push(item.keep2);
    if (item.keep3) questParts.push(item.keep3);

    html += `
      <div class="item-name" style="color:${nameColor}">${item.name}</div>
      ${item.rarity ? `<div class="line">Rarity: ${item.rarity}</div>` : ""}
      ${item.category ? `<div class="line">Category: ${item.category}</div>` : ""}
      ${item.sellPrice ? `<div class="line" style="color:${priceColor}; font-weight:bold;">Sell Price: ${item.sellPrice}</div>` : ""}
      ${recycleParts.length ? `<div class="line">Recycles To: ${recycleParts.join(", ")}</div>` : ""}
      ${questParts.length ? `<div class="line">Quest: ${questParts.join(", ")}</div>` : ""}
      ${item.notes ? `<div class="line">Notes: ${item.notes}</div>` : ""}
      <hr>
    `;
  });

  out.innerHTML = html;
}

/* ======================
   REVERSE SEARCH MODE
====================== */
let timer2 = null;
searchReverse.addEventListener("input", function () {
  clearTimeout(timer2);
  const q = this.value.trim();
  timer2 = setTimeout(() => runReverseSearch(q), 100);
});

function runReverseSearch(query) {
  const q = query.toLowerCase();
  const out = document.getElementById("result");
  out.innerHTML = "";
  if (!q) return;

  const recyclers = data.filter(d => {
    const r1 = extractItemNameFromRecycle(d.recycle1 || "").toLowerCase();
    const r2 = extractItemNameFromRecycle(d.recycle2 || "").toLowerCase();
    return (r1 === q || r2 === q);
  });

  if (!recyclers.length) {
    out.innerHTML = "<div>No items recycle into this</div>";
    return;
  }

  let html = `<div class="section-header">Items that recycle into: ${query}</div>`;

  recyclers.forEach(item => {
    const rarity = item.rarity.toLowerCase();
    const nameColor = rarityColor(rarity);

    const priceNum = parseInt((item.sellPrice || "").replace(/[^0-9]/g,"")) || 0;
    const priceColor = priceColorPick(priceNum);

    html += `
      <div class="line">
        <span style="color:${nameColor}; font-weight:bold;">${item.name}</span>
        â€”
        <span style="color:${priceColor}; font-weight:bold;">${item.sellPrice || "0"}</span>
      </div>
    `;
  });

  out.innerHTML = html;
}

/* ======================
   COLOR HELPERS
====================== */
function rarityColor(r) {
  if (r.includes("uncommon")) return "#00ff00";
  if (r.includes("rare")) return "#1e90ff";
  if (r.includes("epic")) return "#ff00ff";
  if (r.includes("legendary")) return "#ffd700";
  return "white";
}

function priceColorPick(n) {
  if (n >= 1000 && n <= 2000) return "#00ff00";
  if (n >= 2001 && n <= 5000) return "#ff69b4";
  if (n >= 5001) return "#ffd700";
  return "white";
}
</script>

</body>
</html>
