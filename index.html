<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ARC Lookup</title>
<style>
  body {
    background:#000;
    color:#fff;
    font-family:Segoe UI, sans-serif;
    padding:20px;
  }

  .top-buttons {
    display:flex;
    gap:10px;
    margin-bottom:15px;
    flex-wrap:wrap;
  }
  .top-buttons a {
    background:#222;
    color:#fff;
    border:1px solid #444;
    border-radius:6px;
    padding:6px 12px;
    font-size:14px;
    text-decoration:none;
    cursor:pointer;
  }
  .top-buttons a:hover {
    background:#333;
  }

  input {
    font-size:22px;
    padding:12px;
    width:95%;
    margin-bottom:15px;
  }

  .item-title {
    font-size:26px;
    font-weight:bold;
    margin-bottom:4px;
  }

  .line {
    margin:4px 0;
    font-size:18px;
  }

  hr {
    border:1px solid #333;
    margin:10px 0;
  }
</style>
</head>
<body>

<div class="top-buttons">
  <a href="https://mapgenie.io/arc-raiders" target="_blank">Maps</a>
  <a href="https://docs.google.com/spreadsheets/d/1FYBQG7Zq-hb-73baiUtMGrUUUjtif3mbBUZcpHN2X3U/edit?gid=732163012#gid=732163012"
     target="_blank">Spreadsheet</a>
</div>

<input id="search" placeholder="Type item name..." autofocus>
<div id="result"></div>

<script>
const sheetURL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vQ8XIQtZGS9iURh9D5oWsgyyBMqNJkLy9x0olt6DKKlCHevSpZ3qQevYZjrpctOLjOUyDFv1HEjkqGq/pub?output=csv";

const data = [];

/* Always clear search when clicked */
document.getElementById("search").addEventListener("focus", function () {
  this.value = "";
});

/* Load CSV */
fetch(sheetURL)
  .then(r => r.text())
  .then(text => {
    const rows = text.replace(/\r/g,"").split("\n");
    rows.shift();
    for (let r of rows) {
      if (!r.trim()) continue;
      const f = csvSplit(r);
      data.push({
        name:      f[0] || "",
        rarity:    f[1] || "",
        recycle1:  f[2] || "",
        recycle2:  f[3] || "",
        sellPrice: f[4] || "",
        category:  f[5] || "",
        keep1:     f[6] || "",
        keep2:     f[7] || "",
        keep3:     f[8] || "",
        notes:     f[9] || ""
      });
    }
});

function csvSplit(row) {
  let out = [], field = "", q = false;
  for (const ch of row) {
    if (ch === '"') { q = !q; continue; }
    if (ch === ',' && !q) { out.push(field); field = ""; continue; }
    field += ch;
  }
  out.push(field);
  return out;
}

function extractItemNameFromRecycle(str) {
  return str.replace(/^\s*\d+\s*x\s*/i, "").trim();
}

function rarityColor(r) {
  r = r.toLowerCase();
  if (r.includes("uncommon")) return "#00ff00";
  if (r.includes("rare")) return "#1e90ff";
  if (r.includes("epic")) return "#ff00ff";
  if (r.includes("legendary")) return "#ffd700";
  return "white";
}

function priceColorPick(n) {
  if (n >= 1000 && n <= 2000) return "#00ff00";
  if (n >= 2001 && n <= 5000) return "#ff69b4";
  if (n >= 5001) return "#ffd700";
  return "white";
}

/* ======================
   MAIN SEARCH
====================== */
let timer = null;
document.getElementById("search").addEventListener("input", function () {
  clearTimeout(timer);
  timer = setTimeout(() => runSearch(this.value.trim()), 100);
});

function runSearch(query) {
  const out = document.getElementById("result");
  out.innerHTML = "";
  if (!query) return;

  const q = query.toLowerCase();
  const matches = data.filter(d => d.name.toLowerCase().includes(q));

  if (!matches.length) {
    out.innerHTML = "<div>No match</div>";
    return;
  }

  let html = "";

  matches.forEach(item => {
    const nameColor = rarityColor(item.rarity);
    const priceNum = parseInt(item.sellPrice.replace(/[^0-9]/g,"")) || 0;
    const priceColor = priceColorPick(priceNum);

    const recycleParts = [];
    if (item.recycle1) recycleParts.push(item.recycle1);
    if (item.recycle2) recycleParts.push(item.recycle2);

    /* Reverse Recycle Lookup (each on its own line) */
    const recyclers = data.filter(d => {
      const r1 = extractItemNameFromRecycle(d.recycle1 || "").toLowerCase();
      const r2 = extractItemNameFromRecycle(d.recycle2 || "").toLowerCase();
      return (r1 === item.name.toLowerCase() || r2 === item.name.toLowerCase());
    });

    html += `
      <div class="item-title" style="color:${nameColor}">
        ${item.name}
        <span style="color:${priceColor}; font-size:20px;">— ${item.sellPrice}</span>
      </div>
    `;

    if (recycleParts.length) {
      html += `<div class="line">Recycles To: ${recycleParts.join(", ")}</div>`;
    }

    if (recyclers.length) {
      html += `<div class="line" style="color:#ffa500;">Recycled From:</div>`;
      recyclers.forEach(src => {
        const rColor = rarityColor(src.rarity);
        const pNum = parseInt(src.sellPrice.replace(/[^0-9]/g,"")) || 0;
        const pColor = priceColorPick(pNum);

        html += `
          <div class="line">
            <span style="color:${rColor}; font-weight:bold;">${src.name}</span>
            —
            <span style="color:${pColor}; font-weight:bold;">${src.sellPrice}</span>
          </div>
        `;
      });
    }

    if (item.notes) {
      html += `<div class="line">Notes: ${item.notes}</div>`;
    }

    html += `<hr>`;
  });

  out.innerHTML = html;
}
</script>
</body>
</html>
